# Production overrides
# Usage: docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d

services:
  web:
    restart: always
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"
    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 512M
    # Security: read-only root filesystem where possible
    read_only: true
    tmpfs:
      - /tmp
      - /home/appuser/.aspnet
    security_opt:
      - no-new-privileges:true

  ssr:
    restart: always
    logging:
      driver: "json-file"
      options:
        max-size: "20m"
        max-file: "3"
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: "1.0"
        reservations:
          memory: 128M
    read_only: true
    tmpfs:
      - /tmp
    security_opt:
      - no-new-privileges:true
